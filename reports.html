<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reports | Field Visit System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial;background:#f4f6f8}
header{background:#1f3a5f;color:#fff;padding:15px;display:flex;justify-content:space-between}
header button{background:#c62828;color:#fff;border:none;padding:8px}
.main{padding:20px}
.container{background:#fff;padding:20px;border-radius:8px}
label{display:block;margin-top:10px}
input,select,button{width:100%;padding:8px;margin-top:5px}
table{width:100%;border-collapse:collapse;margin-top:15px;font-size:13px}
th,td{border:1px solid #ccc;padding:6px}
th{background:#eef2f7}
.filters{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
button.primary{background:#1f3a5f;color:#fff;border:none;margin-top:10px}
</style>
</head>

<body>

<header>
  <b>Reports</b>
  <button onclick="logout()">Logout</button>
</header>

<div class="main">
  <div class="container">

    <h3>Visit Reports</h3>

    <div class="filters">
      <div>
        <label>From Date</label>
        <input type="date" id="fromDate">
      </div>
      <div>
        <label>To Date</label>
        <input type="date" id="toDate">
      </div>
      <div>
        <label>User</label>
        <input id="userFilter" placeholder="User name">
      </div>
      <div>
        <label>Status</label>
        <select id="statusFilter">
          <option value="">All</option>
          <option>Pending</option>
          <option>Completed</option>
        </select>
      </div>
    </div>

    <button class="primary" onclick="loadReport()">Generate Report</button>

    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>User</th>
          <th>Client</th>
          <th>Location</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="reportTable"></tbody>
    </table>

  </div>
</div>

<!-- AUTH -->
<script src="js/auth.js"></script>

<script>
const API = "https://script.google.com/macros/s/AKfycby5CPy0pBMpmAlqpy3SJadJ_oClIS3GzYFgIqeaVK49HYx1Kg0cqWYZTM4LnprPx484uw/exec";

/* AUTH */
requireLogin();
requireRole(["ADMIN", "GM", "SR_ABDM"]);

function loadReport() {
  fetch(API, {
    method: "POST",
    body: JSON.stringify({
      action: "getReport",
      requester_role: user.role,
      from: fromDate.value,
      to: toDate.value,
      user: userFilter.value,
      status: statusFilter.value
    })
  })
  .then(r => r.json())
  .then(d => {
    reportTable.innerHTML = "";
    if (!d.success) return;

    d.reports.forEach(r => {
      reportTable.innerHTML += `
        <tr>
          <td>${r.date}</td>
          <td>${r.user}</td>
          <td>${r.client}</td>
          <td>${r.location}</td>
          <td>${r.status}</td>
        </tr>
      `;
    });
  });
}
</script>

</body>
</html>
